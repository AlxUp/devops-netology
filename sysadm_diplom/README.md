ДИПЛОМНЫЙ ПРОЕКТ ПО ПРОФЕССИИ "СИСТЕМНЫЙ АДМИНИСТРАТОР LINUX" - УПКИН АЛЕКСАНДР


   Содержание:

   * Задача
   * Инфраструктура
   * Сайт
   * Мониторинг
   * Логи
   * Сеть
   * Резервное копирование
   * Дополнительно
   * Выполнение работы
   * Критерии сдачи


Задача

1. Ключевая задача - разработать отказоустойчивую инфраструктуру для сайта, включающую мониторинг, сбор логов и резервное копирование основных данных. Инфраструктура должна размещаться в Yandex Cloud.

2. Инфраструктура
Для развертки инфраструктуры используйте `Terraform` и `Ansible`.

3. Параметры виртуальной машины (ВМ) подбирайте по потребностям сервисов, которые будут на ней работать.

4. Пожалуйста, ознакомьтесь со всеми пунктами из этой секции, не беритесь сразу выполнять задание, не дочитав до конца. Пункты тут взаимосвязаны и могут влиять друг на друга.

5. Сайт
Создайте две ВМ в разных зонах, установите на них сервер `nginx`, если его там нет. ОС и содержимое ВМ должно быть идентичным, это будут наши web-сервера.

6. Используйте набор статичных файлов для сайта. Можно переиспользовать сайт из домашнего задания.

7. Создайте `Target Group`, включите в нее две созданных ВМ.

8. Создайте `Backend Group`, настройте `backends` на `target group` ранее созданную. Настройте `healthcheck` на корень `(/)` и порт 80, протокол HTTP

9. Создайте `HTTP router`. Путь укажите `- /`, `backend group` - созданную ранее.

10. Создайте `Application load balance`r для распределения трафика на web-сервера, созданные ранее. Укажите HTTP router созданный ранее, задайте listener тип auto, порт 80.

11. Протестируйте сайт `curl -v <публичный IP балансера>:80`

12. Мониторинг
Создайте ВМ, разверните на ней `Prometheus`. На каждую ВМ из web серверов установите `Node Exporter` и `Nginx Log Exporter`. Настройте `Prometheus` на сбор метрик с этих exporter.

13. Создайте ВМ, установите туда `Grafana`. Настройте ее на взаимодейтсвие с ранее развернутым `Prometheus`. Настройте дешборды с отображением метрик, минимальный набор - `Utilization`, `Saturation`, `Errors` для `CPU`, `RAM`, диски, сеть, `http_response_count_total, http_response_size_bytes`. Добавьте необходимые `tresholds` на соответствующие графики.

14. Логи
Cоздайте ВМ, разверните на ней `Elasticsearch`. Установите `filebeat` в ВМ к web-серверам, настройте на отправку `access.log`, `error.log nginx` в `Elasticsearch`.

15. Создайте ВМ, разверните на ней `Kibana`, сконфигурируйте соединение с `Elasticsearch`.

16. Сеть
Разверните один `VPC`. Сервера `web`, `Prometheus`, `Elasticsearch` поместите в приватные подсети. Сервера `Grafana`, `Kibana`, `application load balancer` определите в публичную подсеть.

17. Настройте `Security Groups` соответствующих сервисов на входящий трафик только к нужным портам.

18. Настройте ВМ с публичным адресом, в которой будет открыт только один порт `- ssh`. Настройте все `security groups` на разрешение входящего ssh из этой security group. Эта вм будет реализовывать концепцию `bastion host`. Потом можно будет подключаться по ssh ко всем хостам через этот хост.

19. Резервное копирование
Создайте snapshot дисков всех ВМ. Ограничьте время жизни snaphot в неделю. Сами snaphot настройте на ежедневное копирование.

